{
  "version": "1",
  "dslSpecVersion": "1.1.0",
  "actionsSpecVersion": "1",
  "executionFlow": [
    {
      "parallel": {
        "input": "${.}",
        "branches": [
          {
            "name": "Branch 1",
            "steps": [
              {
                "action": {
                  "function": {
                    "type": "executeCustomScript",
                    "params": {
                      "commandLine": "/root/XDR/get_user_sessions.sh",
                      "commandLineParameters": "${\"--action get_user_sessions --host \" + (alert.Observables | map(select(.Type==\"hostname\") | .Value | split(\"\\\\\") | .[-1]) | join(\",\"))}",
                      "stdIn": "",
                      "workingDirectory": ""
                    }
                  },
                  "onError": "stop",
                  "timeout": {
                    "scheduleToCloseTimeout": "24h"
                  },
                  "output": {
                    "filter": "${ {userSessions: .} }",
                    "action": "overwrite"
                  }
                }
              },
              {
                "action": {
                  "function": {
                    "type": "addCommentToAlert",
                    "params": {
                      "text": "${ \"User sessions: \\n\n\" + .userSessions.details.stdOut }"
                    }
                  },
                  "onError": "stop",
                  "timeout": {
                    "scheduleToCloseTimeout": "24h"
                  }
                }
              }
            ]
          },
          {
            "name": "Branch 2",
            "steps": [
              {
                "action": {
                  "function": {
                    "type": "executeCustomScript",
                    "params": {
                      "commandLine": "/root/XDR/get_user_sessions.sh",
                      "commandLineParameters": "${\"--action get_sudo_users --host \" + (alert.Observables | map(select(.Type==\"hostname\") | .Value | split(\"\\\\\") | .[-1]) | join(\",\"))}",
                      "stdIn": "",
                      "workingDirectory": ""
                    }
                  },
                  "onError": "stop",
                  "timeout": {
                    "scheduleToCloseTimeout": "24h"
                  },
                  "output": {
                    "filter": "${ {sudoUsers: .} }",
                    "action": "overwrite"
                  }
                }
              },
              {
                "action": {
                  "function": {
                    "type": "addCommentToAlert",
                    "params": {
                      "text": "${ \"Sudo users: \\n\n\" + .sudoUsers.details.stdOut }"
                    }
                  },
                  "onError": "stop",
                  "timeout": {
                    "scheduleToCloseTimeout": "24h"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  ]
}
